function DropZone(e,t,i){this.dropTarget=e,this.input=t,this.callback=i,this.dropTarget.addEventListener("dragover",this.onHover.bind(this),!1),this.dropTarget.addEventListener("dragleave",this.onHover.bind(this),!1),this.dropTarget.addEventListener("drop",this.onDrop.bind(this)),this.input.addEventListener("change",this.onChange.bind(this),!1)}function Player(e,t){this.context=new(window.AudioContext||window.webkitAudioContext),this.analyser=this.context.createAnalyser(),this.analyser.connect(this.context.destination),this.analyser.minDecibels=-140,this.analyser.maxDecibels=0,this.freqs=new Uint8Array(this.analyser.frequencyBinCount),this.canvas=$("canvas"),this.drawContext=this.canvas.getContext("2d"),this.isPlaying=!1,this.startTime=0,this.startOffset=0,this.metadata={title:"Unknown",artist:"",album:""},this.width=window.innerWidth,this.height=window.innerHeight,this.file=e}var $=document.querySelector.bind(document);DropZone.prototype.onHover=function(e){e.stopPropagation(),e.preventDefault(),"dragover"==e.type?this.dropTarget.classList.add("hover"):this.dropTarget.classList.remove("hover")},DropZone.prototype.onDrop=function(e){this.onHover(e),this.files=e.target.files||e.dataTransfer.files,this.callback&&this.callback()},DropZone.prototype.onChange=function(e){this.files=e.target.files||e.dataTransfer.files,this.callback&&this.callback()},window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)}}(),Player.prototype.load=function(e,t){var i=this;i.callback=t;var n=new XMLHttpRequest;n.open("GET",e,!0),n.responseType="arraybuffer",n.onload=function(){i.arraybuffer=n.response,i.dv=new jDataView(player.arraybuffer),"TAG"==i.dv.getString(3,i.dv.byteLength-128)?(i.metadata.title=i.dv.getString(30,i.dv.tell()),i.metadata.artist=i.dv.getString(30,i.dv.tell()),i.metadata.album=i.dv.getString(30,i.dv.tell())):i.metadata.title=i.file_input.name,i.context.decodeAudioData(i.arraybuffer,function(t){return t?(i.buffer=t,void(i.callback&&i.callback())):void alert("Ошибка в декодировании файла, попробуйте снова или другой файл: "+e)},function(e){console.error("contet.decodeAudioData: error",e)})},n.onerror=function(){alert("Player.load: XHR error")},n.send()},Player.prototype.toggle=function(){self=this,self.isPlaying?(self.source.stop(0),self.startOffset+=self.context.currentTime-self.startTime):(self.startTime=self.context.currentTime,self.source=self.context.createBufferSource(),self.source.connect(self.analyser),self.source.buffer=self.buffer,self.source.start(0,self.startOffset%self.buffer.duration),requestAnimFrame(self.draw.bind(self))),self.isPlaying=!self.isPlaying},Player.prototype.draw=function(){var e=this;e.analyser.getByteFrequencyData(this.freqs),e.canvas.width=e.width,e.canvas.height=e.height;for(var t=0;t<this.analyser.frequencyBinCount;t++){var i=Math.ceil(e.width/e.analyser.frequencyBinCount),n=e.height*(e.freqs[t]/256),r=e.height/2-n/2;e.drawContext.fillStyle="rgba(227, 71, 71, 1)",e.drawContext.fillRect(t*i,r,i,n)}e.isPlaying&&requestAnimFrame(e.draw.bind(e))},Player.prototype.redraw=function(){var e=this;e.width=window.innerWidth,e.height=window.innerHeight,!e.isPlaying&&e.draw()};
//# sourceMappingURL=./player.min.js.map